<html>
<title>How it works</title>
<link rel="stylesheet" type="text/css" href="style.css">
<body bgcolor=white text=darkblue vlink=#AC003A>
<blockquote>

<h1><img src="logo.png"></h1>

<h2>How it works</h2>

<strong>Concepts</strong><p>

Clapf is a very flexible application suite. You may use it as a content-filter
on the localhost, or as an appliance on a separate box, or with maildrop from
the user's .forward file.<p/>

Usually clapf listens on 127.0.0.1:10025/tcp for unfiltered messages.<p/>

Postfix is configured to forward every incoming mail to clapf. Clapf does its
job (scans mail) and if a virus is found, it rejects with "550 Access denied"
than removes the message and syslogs the event.<p/>

Otherwise it checks whether the message is spam or not, inserts some info in a
custom header field, then injects the mail back to postfix (127.0.0.1:10026/tcp),
and respondes with "250 Ok". If postfix rejects clapf with with "550" error code
after the MAIL or RCPT commands, clapf drops the message and syslogs the event.
You may configure clapf (look the configuration file how) to send a notification
if a virus infected email arrived. Note that this is disabled by default.<p/>

Note that clapf does not respond to the PERIOD (.) command until it can
determine that the message is infected or not, or until clapf itself got a
return code (250, 550, or something) from postfix.<p/>

If clapf times out it sends a "421 timed out" message back.<p/>

<strong>How to keep with virus database changes</strong><p>

Keeping the (anti)virus database up to date depends on the antivirus product you
use. If you have clamav, you may use util/upgrade_clamav.sh as an example how to
refresh the clamav AV database and notify clapf about it.<p>


<strong>How to reload its configuration</strong><p>

<pre>
killall -HUP clapf
</pre>

<strong>RFC compatibility</strong><p>

clapf implements the minimum SMTP commands defined in RFC 821 (but only in short 4-letter form).
(HELO,MAIL,RCPT,DATA,NOOP,RSET,QUIT + EHLO)


<center><a href="index.html">home</a></center><p>

</blockquote>
</body></html>
