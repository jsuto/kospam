<html>
<title>FAQ</title>
<link rel="stylesheet" type="text/css" href="style.css">
<body bgcolor=white text=darkblue vlink=#AC003A>
<blockquote>

<h1><img src="logo.png"></h1>

<h2>FAQ</h2>

<p>

<a name="ss11">What to do with the clamav error messages?</a><p>

<strong>Issue:</strong> You can see the following error messages:<p>

<pre>

"LibClamAV Error: cli_cvdload():  Can't create temporary directory /tmp/clamav-a0480b63a7872f98"

"LibClamAV Error: Wrote 0 instead of 512 (/tmp/clamav-75668d156e64018e/main.db).
 LibClamAV Error: cli_cvdload(): Can't unpack CVD file."

"cl_loaddbdir: CVD extraction failure."
</pre>

These messages mean that clapf has not got enough space under $TMPDIR. This may occur
if you have configured clapf to use the libclamav library (not clamd).<p>



<a name="ss12">How could I know what is really happening during message processing?</a><p>

Set verbosity level at least 3 in clapf.conf, then send a HUP signal.

<pre>
verbosity=3
</pre>

Clapf will syslog a lot of things, eg. what SMTP conversation occurs from postfix to
clapf and from clapf to postfix. You may see what clapf does, eg. runs virus scanning,
parsing the message into tokens, etc.<p>

I recommend you do not set verbosity greater than 1 unless you want to debug something.<p>

<a name="ss13">Mailbox issues</a><p>

You should run the dos2unix program to 'fix' the ^M line end issue if you took the mailbox file
from a Dos/Windows host.<p>



<a name="ss14">Problems with NUL characters inside a message</a><p>

Some of you may ran into a problem caused by messages having
NUL characters inside. Though the RFCs don't prohibit this
to happen I found not a single legal (I mean ham) message
that had NUL characters.<p>

Some functions - notably fgets() - may have problems with
buffers having the NUL character inside. I got some messages
that clapf was not able to send back to postfix properly thus
it remained in the queue.<p>

Though clapf does its best to handle such a mail, you may
<b>configure your MTA to reject messages having NUL characters.</b>
Please note that Victor Duchovni wrote the following (2004.09.28):<p>

<i>"Postfix dictionary lookup API uses NUL terminated keys. It is
not possible to use header_checks and body_checks to reject
ASCII NUL in the message content."<p>

"The only viable option at this time is to use a before-queue filter
with Postfix 2.1. The filter can return a 5XX code after "." if the
message body contains any NUL characters.<br>

It should not be too hard to cobble-up a suitable proxy in Perl, but
understand the pre-filter proxy requirements carefully... Bennett Todd's
smtpprox may be a start, but it was designed as an SMTP only (no ESMTP)
proxy content filter not a pre-queue filter, so some changes will need
to be made..."<p></i>

For more info, please visit <a href="http://www.webservertalk.com/archive281-2004-9-413017.html">
http://www.webservertalk.com/archive281-2004-9-413017.html</a><p>

I've seen that others have a(n unofficial) patch for postfix to reject messages with
NUL characters. Anyway this latter B) option may be tricky. I recommend the
solution A).<p>

And of course clapf as an advanced content filter may check the message
for the series of NUL characters and optionally return 5xx code
as Victor Duchovni mentioned above. If you want this option, just
let me know and I'll code it.<p>


<a name="ss15">I have Outlook Express mailbox. How can I create a token database?</a><p>

I found the following article: 
<a href="http://mail.python.org/pipermail/spambayes/2003-March/004128.html">http://mail.python.org/pipermail/spambayes/2003-March/004128.html</a><p>

<i>Well, it appears as if I've spoken a bit too soon on this one.  I did some 
digging, and found a program called MailNavigator 
(<a href="http://www.mailnavigator.com/mailnavigator.html">http://www.mailnavigator.com/mailnavigator.html</a>), that can read OE mailboxes 
and export them as an mbox.  I've downloaded it, tried it, and it works.<p> 

When you start it up, do File->Load External Mailbox...  Point the browser 
window at the OE inbox.dbx file, normally in Documents and Settings
\currentuser\Local Settings\Application Data\Identities\{bunchaglorp}
\Microsoft\Outlook Express.  You should see your inbox (or whatever folder you 
loaded) contents in MailNavigator.  Then do Message->Select All, then 
Message->Save As... pick a file name and location, and select file type 
RFC822-text file... et voila, you have an mbox!</i><p>



<center><a href="index.html">home</a></center><p>

<script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-1610427-1";
urchinTracker();
</script>


</blockquote>
</body></html>
