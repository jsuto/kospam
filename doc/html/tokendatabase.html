<html>
<title>Token database</title>
<link rel="stylesheet" type="text/css" href="style.css">
<body bgcolor=white text=darkblue vlink=#AC003A>

<h1><img src="logo.png"></h1>

<h2>Token database</h2>

This documentation describes how to create the initial token database.<p/>

<h3>Using the MySQL backend</h3>

Have a working <a href="http://www.mysql.com/">MySQL database</a>. Configure and compile clapf
with the --with-tokendb=mysql option.<p/>

Create a dedicated MySQL user and database:<p/>

<pre>
mysql -u root -p
mysql>create database clapf;
mysql>grant all privileges on clapf.* to clapf@localhost identified by 'verystrongpassword';
mysql>flush privileges;
mysql>quit;
</pre>

Create a my.cnf file (eg. <i>/usr/local/share/clapf/.my.cnf</i>) :<p/>

<pre>
[mysql]

database = clapf
user = clapf
password = verystrongpassword
</pre>


Set the MySQL account parameters in clapf.conf:<p/>

<pre>
mysqlhost=127.0.0.1
mysqlport=3306
mysqluser=clapf
mysqlpwd=verystrongpassword
mysqldb=clapf
</pre>

If you want to connect via a Unix domain socket:<p/>

<pre>
mysqlsocket=/var/run/mysql/mysql.sock
mysqluser=clapf
mysqlpwd=verystrongpassword
mysqldb=clapf
</pre>

Important! Do not use *both* mysqlsocket and mysqlhost + mysqlport parameters.<p/>

Run a similar cron job to remove old entries:<p/>

<pre class="programlisting">
3 3 * * * mysql --defaults-file=/usr/local/share/clapf/.my.cnf < /usr/local/share/clapf/purge-mysql.sql
</pre>

I recommend you to configure the <a href="http://dev.mysql.com/doc/refman/5.0/en/query-cache-configuration.html">query cache</a>
to allow faster lookups. Be careful with these settings and always test your configuration for the
best results. If you have lots of memory, then create a 32 MB (or even bigger) query cache.<p/>

<pre class="programlisting">mysql&gt; <strong class="userinput"><code>SHOW VARIABLES LIKE 'have_query_cache';</code></strong>
+------------------+-------+
| Variable_name    | Value |
+------------------+-------+
| have_query_cache | YES   |
+------------------+-------+

</pre>

<pre class="programlisting">mysql&gt; <strong class="userinput"><code>SET GLOBAL query_cache_size = 1000000;</code></strong>
Query OK, 0 rows affected (0.00 sec)
</pre>

<pre class="programlisting">mysql&gt; <strong class="userinput"><code>SHOW VARIABLES LIKE 'query_cache_size';</code></strong>
+------------------+--------+
| Variable_name    | Value  |
+------------------+--------+
| query_cache_size | 999424 | 
+------------------+--------+
1 row in set (0.00 sec)
</pre>


From 0.3.30-rc2 the InnoDB database engine is the default. If you want to stick to the old 'MyISAM'
type, then replace the string 'InnoDB' with 'MyISAM' before creating the tables.<p/>

If you have a larger installation, you may consider using a dedicated MySQL server box,
since MySQL has a better performance if it does not have to compete with Postfix for I/O.<p/>

It may be also a good idea to have MySQL create a new file for every table using the InnoDB
engine. If you want this, then specify <i>innodb_file_per_table</i> in my.cnf at the
[mysqld] section:<p/>

<pre>
[mysqld]
innodb_file_per_table
</pre>

Finally, you may want to increase the 'max_allowed_packet' variable to allow
large SQL queries:<p/>

<pre>
[mysqld]
set-variable = max_allowed_packet=8192000
</pre>


You are also free to do other tuning to make MySQL even faster, consult the <a href="http://dev.mysql.com/doc/">MySQL documentation</a>.<p/>



<h3>Using the SQLite backend</h3>

Have <a href="http://www.sqlite.org/">SQLite3</a> installed and you are done. No special prerequisites are necessary.
Be sure to configure and compile clapf with the --with-tokendb=sqlite3 option.<p/>

Run a similar cron job to remove old entries:<p/>

<pre class="programlisting">
3 3 * * * /usr/local/libexec/clapf/purge-sqlite3.sh
</pre>

<p/>



<center><a href="index.html">home</a></center><p>

<script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-1610427-1";
urchinTracker();
</script>


</body></html>
