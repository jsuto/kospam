#########################################################
###     all the cron jobs you may need for clapf      ###
### be sure to review it and adjust it for your needs ###
#########################################################

root's crontab:

### optional: query queue statistics
*/5 * * * * PATH=$PATH:/usr/sbin:/usr/local/sbin /usr/sbin/qshape > LOCALSTATEDIR/lib/clapf/stat/active+incoming
*/5 * * * * PATH=$PATH:/usr/sbin:/usr/local/sbin /usr/sbin/qshape -s > LOCALSTATEDIR/lib/clapf/stat/active+incoming-sender
*/5 * * * * PATH=$PATH:/usr/sbin:/usr/local/sbin /usr/sbin/qshape deferred > LOCALSTATEDIR/lib/clapf/stat/deferred
*/5 * * * * PATH=$PATH:/usr/sbin:/usr/local/sbin /usr/sbin/qshape -s deferred > LOCALSTATEDIR/lib/clapf/stat/deferred-sender


clapf's crontab:


### removed aged tokens
### select the proper line, then uncomment it
#3 3 * * * mysql --defaults-file=DATAROOTDIR/clapf/.my.cnf < DATAROOTDIR/clapf/purge-mysql.sql
#3 3 * * * sqlite3 LOCALSTATEDIR/lib/clapf/data/tokens.sdb < DATAROOTDIR/clapf/purge-sqlite3.sql

### update the quarantine table
*/5 * * * * /usr/bin/php LIBEXECDIR/clapf/qrunner.php /srv/www/webui.yourdomain.com

### purge of the stored messages from the queue directory
1 2 * * * find LOCALSTATEDIR/lib/clapf/queue -type f  -atime +`SBINDIR/clapfconf -q days_to_retain_quarantine_data|cut -f2 -d'='` -exec rm -f '{}' \;

### remove the aged spam images from cache directory
1 2 * * * find /srv/www/webui.yourdomain.com/cache -type f  -atime +`SBINDIR/clapfconf -q days_to_retain_quarantine_data|cut -f2 -d'='` -exec rm -f '{}' \;

### optional: show maillog.pl status
*/5 * * * * /etc/init.d/clapf-maillog status > LOCALSTATEDIR/lib/clapf/stat/clapf-maillog.stat

### optional: show cpu usage
*/5 * * * * LC_ALL=C mpstat | tail -1 | awk '{print $11}' > /var/lib/clapf/stat/cpu.stat

### optional: make regular pdf reports 
1 0 * * * /usr/bin/php LIBEXECDIR/clapf/summary.php /srv/www/webui.yourdomain.com "clapf daily report" "Ham & spam messages" daily
1 0 * * mon /usr/bin/php LIBEXECDIR/clapf/summary.php /srv/www/webui.yourdomain.com "clapf weekly report" "Ham & spam messages" weekly
1 0 1 * * /usr/bin/php LIBEXECDIR/clapf/summary.php /srv/www/webui.yourdomain.com "clapf monthly report" "Ham & spam messages" monthly

### optional: send daily quarantine report to users
0 8 * * * /usr/bin/php LIBEXECDIR/clapf/quarantine-daily-report.php /srv/www/webui.yourdomain.com

### optional: regular AD sync
0 8 * * * /usr/bin/php LIBEXECDIR/clapf/ldap_sync.php /srv/www/webui.yourdomain.com > LOCALSTATEDIR/lib/clapf/stat/adsync.stat

