<html>
<title>clapf iso image</title>
<link rel="stylesheet" type="text/css" href="style.css">
<body bgcolor=white text=darkblue vlink=#AC003A>
<blockquote>

<h1><img src="logo.png"></h1>

<h2>Clapf ISO image</h2>


<h3>What is this all about?</h3>

I made an <a href="http://clapf.acts.hu/arch-clapf-20070108.iso">iso image</a> to get
a complete Linux distribution to use clapf.

I took the lastest <a href="http://www.archlinux.org/">Arch Linux</a> 0.8 base iso CD
image, bundled mysql, openssh, clamav, tinycdb, postfix and clapf - everything in one
place to get a fully functional anti-virus/spam email gateway from scratch.<p/>

The installation is very easy and straightforward, but if you need some help, be sure
to check out the <a href="http://www.archlinux.org/">Arch Linux</a> web site.<p/>

For more info about clapf please join the mailing list (subscribe at clapf-users+subscribe@lists.acts.hu)
or ask me (sj@acts.hu).<p/>


The bundled version of clapf is configured with the following command:

<pre>
CPPFLAGS="-static" ./configure --enable-clamd --enable-mysql --enable-surbl --enable-blackhole --enable-cgi --with-userdb=mysql
</pre>

<h3>Installation instructions</h3>


<strong>Booting the CD-ROM</strong><p/>

Press "ENTER" to boot the CD-ROM - you may set some boot parameters if you need.

When the system is booted type <b>/arch/setup</b> to enter the installation menu.
Then press "OK" to exit the welcome screen. Select "CD-ROM" (1) as installation source.<p/>

<ol>

<li>Prepare Hard Drive<p/>

Select "1" from the menu to prepare your hard drive. You may choose
autoprepare (it creates a small partition as /boot, 256 MB swap space
and the rest as the root (/) partition) or you may partition the
hard drive yourself.

Then press "OK" and select "4" to return the main menu.

<li>Select Packages<p/>

Select "CD" then press "OK".
You may select the device (eg. <i>/dev/hdc</i>) then press "OK" again and again.

We will install the base set, press "OK".

Select all packages by default, press "OK"

Select packages to install, press "OK"

<li>Install packages<p/>

Select "Install packages" (3) from the main menu to install packages, press "OK"

Press "Continue" when the installation is complete.


<li>Configure System<p/>

Select "Configure system" (4) from the main menu.

Select <i>vi</i> (1) or <i>nano</i> (2) as your favourite editor.

Edit <i>/etc/rc.conf</i> and set (at least):

<pre>
LOCALE
TIMEZONE
HOSTNAME
IP address of eth0
default gateway
</pre>

Be sure to remove the exclamation mark (!) from the <i>ROUTES</i> entry or
your default gateway will not be set at boot time.

Then save the file to return to the menu.

Edit <i>/etc/hosts</i> file and add your IP-address and hostname.<p/>

Edit <i>/etc/resolv.conf</i> and set your domain and nameservers.<p/>

You may edit the other files too. When finished select the dash sign (<i>-</i>) to return to the main menu.

<li>Install Kernel<p/>

Select the "Install Kernel" (5) menu. You must select "v2.6", then
press "OK".

Press "Continue" when the installation is complete, then press "OK".

<li>Install Bootloader<p/>

Select "Install Bootloader" (6) from the main menu.
Select "GRUB" or "LILO" then press "OK". I prefer LILO.
Press "OK"

Review the <i>/etc/lilo.conf</i>, make some adjustments if you want to, then
save the file. The installer tries to install LILO.<p/>

Warning! If you got an error message, then you must go back and edit
lilo.conf until you see the <i>LILO was successfully installed.</i> message
otherwise your system will not boot.

Press "OK" if everything went fine.

<li>Exit Installer<p/>

Select "Exit Installer" (7) from the main menu to exit the installer.
Type <b>reboot</b> to reboot your computer. Make sure you boot from your
hard drive and not from the CD-ROM.

</ol>

<strong>Post installation</strong><p/>

Login as <i>root</i> (you have an empty password) and change the root password immediately.
You may wish to upgrade your system via the Internet.<p/>

Then mount the CD-ROM:

<b>mount /mnt/cd</b><p/>

Run the post installation script which installs postfix, clamav, tinycdb, clapf and
openssh:

<b>sh /mnt/cd/my/postinstall.sh</b><p/>

Now sshd, postfix, clamd and clapf should be running. Be sure to create the token
database from your ham and spam as it's in the <a href="http://clapf.acts.hu/">documentation</a>.<p/>

<strong>Post configuration</strong><p/>

Postfix needs some parameters to be configured before use in <i>/etc/postfix/main.cf</i>

<pre>
myhostname
myorigin
mydestination
mynetworks
</pre>

Edit them, then issue the <b>postfix reload</b> command. Of course you may configure other
parameters too.<p/>

The <i>/mnt/cd/my/postinstall.sh</i> script creates the clapf mysql user with <i>changme</i>
as its default password. I strongly recommend you to change it as well as in the
<i>/usr/local/etc/clapf.conf</i> file.<p/>

Of course you may do additional configuration, such as hardening, additional
clapf configuration, etc...<p/>

Then reboot and make sure everything comes up properly.<p/>

I recommend you to set up a cron entry to restart clapf if it would die
<pre>
*/2 * * * * /usr/local/bin/check_clapf.sh
</pre>

<strong>Further tips</strong><p/>

If you want the OCR functionality you need the gocr package, so issue the
following command (after package database synchronisation: <b>pacman -Sy</b>):<p/>

<b>pacman -S gocr</b><p/>

The catdoc utility can be used to extract text from word documents. If you want it,
type: <b>pacman -S catdoc</b><p/>


<center><a href="index.html">home</a></center><p>

</blockquote>
</body></html>
