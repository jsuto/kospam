1. Always backup your current clapf.conf file and the clapf database.

2. Do a "make install" to replace your old binaries, and other stuff.

3. If you already have a clapf.conf file "make install" will not
update it, you should review the newer config file and modify it
according to your settings.

If you store your user data in SQL:
-----------------------------------

4. Create the t_policy table, then update the user table according 
to the new db.sql schema:

alter table user add column policy_group int(4) default 0;
alter table user drop column action;
alter table user drop column pagelen;

5. Make sure that your t_policy table has the store_metadata
field. If it's not than apply this statement:

alter table t_policy add column store_metadata tinyint default 0;

6. Make sure you have the t_black_list table, if not then apply
this statement:

create table if not exists t_black_list (
        uid int unsigned not null primary key,
        blacklist blob default null
);

create index t_black_list_idx on t_black_list (uid);


7. Make sure your users exist in t_white_list and t_black_list tables.
If not, then create such an SQL commands:

insert t_white_list (uid, whitelist) values(0, '');
insert t_white_list (uid, whitelist) values(1, '');
insert t_white_list (uid, whitelist) values(2, '');
....

insert t_black_list (uid, blacklist) values(0, '');
insert t_black_list (uid, blacklist) values(1, '');
insert t_black_list (uid, blacklist) values(2, '');
...

Of course, you can script this :-)


If you store your user data in LDAP:
------------------------------------

7. Update the policy schema of clapf, using ldap/clapf-policy.schema


