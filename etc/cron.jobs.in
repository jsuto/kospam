#########################################################
###     all the cron jobs you may need for clapf      ###
### be sure to review it and adjust it for your needs ###
#########################################################

1 0 * * * /usr/bin/php LIBEXECDIR/clapf/summary.php /srv/www/webui.yourdomain.com "clapf daily report" "Ham & spam messages" daily
1 0 * * mon /usr/bin/php LIBEXECDIR/clapf/summary.php /srv/www/webui.yourdomain.com "clapf weekly report" "Ham & spam messages" weekly
1 0 1 * * /usr/bin/php LIBEXECDIR/clapf/summary.php /srv/www/webui.yourdomain.com "clapf monthly report" "Ham & spam messages" monthly


root's crontab:

*/5 * * * * PATH=$PATH:/usr/sbin:/usr/local/sbin /usr/sbin/qshape > LOCALSTATEDIR/lib/clapf/stat/active+incoming
*/5 * * * * PATH=$PATH:/usr/sbin:/usr/local/sbin /usr/sbin/qshape -s > LOCALSTATEDIR/lib/clapf/stat/active+incoming-sender
*/5 * * * * PATH=$PATH:/usr/sbin:/usr/local/sbin /usr/sbin/qshape deferred > LOCALSTATEDIR/lib/clapf/stat/deferred
*/5 * * * * PATH=$PATH:/usr/sbin:/usr/local/sbin /usr/sbin/qshape -s deferred > LOCALSTATEDIR/lib/clapf/stat/deferred-sender


clapf's crontab:


### purge aged history entries (you only need this if you use sqlite3 history database)
#2 2 * * * sed "s/DAYS_TO_RETAIN/`SBINDIR/clapfconf -q days_to_retain_data|cut -f2 -d = `/" DATAROOTDIR/clapf/history-purge-sqlite3.sql | sqlite3 `SBINDIR/clapfconf -q historydb | cut -f2 -d '='`

### removed aged tokens
### select the proper line, then uncomment it
#3 3 * * * mysql --defaults-file=DATAROOTDIR/clapf/.my.cnf < DATAROOTDIR/clapf/purge-mysql.sql
#3 3 * * * sqlite3 LOCALSTATEDIR/lib/clapf/data/tokens.sdb < DATAROOTDIR/clapf/purge-sqlite3.sql

### purge of the stored messages from the queue directory
1 2 * * * find LOCALSTATEDIR/lib/clapf/queue -type f  -atime +`SBINDIR/clapfconf -q days_to_retain_data|cut -f2 -d'='` -exec rm -f '{}' \;

### remove the aged spam images from cache directory
1 2 * * * find /srv/www/webui.yourdomain.com/cache -type f  -atime +`SBINDIR/clapfconf -q days_to_retain_data|cut -f2 -d'='` -exec rm -f '{}' \;

### count the number of quarantined messages
*/5 * * * * find LOCALSTATEDIR/lib/clapf/queue/ -name s\.\* | wc -l > LOCALSTATEDIR/lib/clapf/stat/quarantined.messages

### show cpu usage
*/5 * * * * mpstat -P ALL > /var/lib/clapf/stat/cpu.stat

