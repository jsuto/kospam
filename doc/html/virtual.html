<html>
<title>Virtual users</title>
<link rel="stylesheet" type="text/css" href="style.css">
<body bgcolor=white text=darkblue vlink=#AC003A>
<blockquote>

<h1><img src="logo.png"></h1>

<h2>Virtual users</h2>

Clapf supports virtual users only in daemon mode currently.<p/>

You have to do 3 things:

<ol>

<li>add them to the clapf database with the clapf_admin utility</li>

<li>set up their own queue directory, eg.
<pre>
mkdir -p /usr/local/var/clapf/queue/a/alice
mkdir -p /usr/local/var/clapf/queue/b/bob
...
mkdir -p /usr/local/var/clapf/queue/j/joe
...
</pre>

A) if you are using spam quarantine:

<pre>
chown av:www-data /usr/local/var/clapf/queue/j/joe
chmod 775 /usr/local/var/clapf/queue/j/joe
</pre>

www-data: group of the web server<p/>

B) if you are not interested in the spam quarantine:

<pre>
chown av:hamspam /usr/local/var/clapf/queue/j/joe
chmod 750 /usr/local/var/clapf/queue/j/joe
</pre>

</li>


<li>

<strong>A) using the content filter (daemon mode):</strong></p>

Then let the users forward every ham message to <a href="mailto:user+ham@domain">user+ham@domain</a>,
and every spam to <a href="mailto:user+spam@domain">user+spam@domain</a>.<p/>

<strong>B) using spamdrop:</strong></p>

set up 2 training accounts:

<pre>
groupadd hamspam
useradd -g hamspam -d /home/ham -s /bin/sh ham
usermod -L ham
useradd -g hamspam -d /home/spam -s /bin/sh spam
usermod -L spam

mkdir ~ham; chown -R ham:hamspam ~ham
mkdir ~spam; chown -R spam:hamspam ~spam

# setup .forward files
echo "|/usr/local/bin/maildrop" > ~ham/.forward
echo "|/usr/local/bin/maildrop" > ~spam/.forward

# create maildrop configuration files as follows:
echo 'xfilter "/usr/local/bin/spamdrop -p"' > ~ham/.mailfilter
echo 'to "/dev/null"' >> ~ham/.mailfilter

echo 'xfilter "/usr/local/bin/spamdrop -p"' > ~spam/.mailfilter
echo 'to "/dev/null"' >> ~spam/.mailfilter

# fix owner and permissions
chown ham:hamspam ~ham/.mailfilter
chown spam:hamspam ~spam/.mailfilter
chmod 600 ~ham/.mailfilter
chmod 600 ~spam/.mailfilter

#create to queue directory
mkdir -p /usr/local/var/clapf/queue/s/spam
mkdir -p /usr/local/var/clapf/queue/h/ham

chown spam:hamspam /usr/local/var/clapf/queue/s/spam
chown spam:hamspam /usr/local/var/clapf/queue/h/ham

chmod 770 /usr/local/var/clapf/queue/s/spam
chmod 770 /usr/local/var/clapf/queue/h/ham
</pre>

Users should submit their spam to <a href="mailto:spam+spam@yourdomain">spam+spam@yourdomain</a>
and their ham to <a href="mailto:ham+ham@yourdomain">ham+ham@yourdomain</a>.<p/>


</ol>


<center><a href="index.html">home</a></center><p>

<script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-1610427-1";
urchinTracker();
</script>


</blockquote>
</body></html>
