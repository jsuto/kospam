#!/bin/sh
##
##
#
# maillog.pl      maillog.pl is a mail.log data collector daemon
#
# chkconfig: 2345 80 30
# description: maillog.pl is a mail.log data collector for clapf
# processname: maillog.pl
# pidfile: /var/run/clapf/history.pid
# config: /data/apps/clapf/current/etc/clapf.conf

# Source function library.
. /etc/rc.d/init.d/functions

# Source networking configuration.
. /etc/sysconfig/network

NAME="maillog.pl"
PREFIX="_PREFIX_"
PARAMS="${PREFIX}/etc/clapf.conf"
RETVAL=0
PID_FILE=`${PREFIX}/sbin/clapfconf -q historypid | cut -f2 -d '='`
PID_NUMBER=`test -f ${PID_FILE} && cat ${PID_FILE}`
PID_DIR=`dirname ${PID_FILE}`
_UID=`${PREFIX}/sbin/clapfconf -q username | cut -f2 -d '='`
_GID=`id -gn ${_UID}`

test -d ${PID_DIR} || install -m 755 -o ${_UID} -g ${_GID} -d ${PID_DIR}


start() {
	echo -n $"Starting $NAME: "
	${PREFIX}/libexec/clapf/maillog.pl ${PARAMS} 2>/dev/null 1>&2 && success || failure $"${NAME} start"
	RETVAL=$?
	[ $RETVAL -eq 0 ] && touch /var/lock/subsys/${NAME}
	echo
	return $RETVAL
}

stop() {
	echo -n $"Shutting down ${NAME}: "
	kill ${PID_NUMBER}
	RETVAL=$?
	echo
	return $RETVAL
}

case "$1" in
	start)
		start;
   	;;

	stop)
		stop;
   	;;

	restart)
		stop;
		sleep 1;
		start;
   	;;

	*)
		echo "Usage: $0 start|stop|restart"
esac

